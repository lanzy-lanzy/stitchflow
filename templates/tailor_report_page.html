{% extends 'base.html' %}
{% load static %}

{% block title %}Generate Report - El Senior Dumingag{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        --warning-gradient: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        --info-gradient: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        --purple-gradient: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
        --teal-gradient: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
        --orange-gradient: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        --pink-gradient: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-large: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        --glow-primary: 0 0 20px rgba(102, 126, 234, 0.3);
        --glow-success: 0 0 20px rgba(74, 222, 128, 0.3);
        --glow-warning: 0 0 20px rgba(251, 191, 36, 0.3);
    }

    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        min-height: 100vh;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .glass-effect {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: var(--shadow-xl);
    }

    .stat-card {
        background: var(--primary-gradient);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.6s ease;
    }

    .stat-card::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
        border-radius: 26px;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .stat-card:hover::before {
        left: 100%;
    }

    .stat-card:hover::after {
        opacity: 1;
    }

    .stat-card:hover {
        transform: translateY(-8px) scale(1.03);
        box-shadow: var(--shadow-xl), var(--glow-primary);
    }

    .stat-card.success {
        background: var(--success-gradient);
    }

    .stat-card.success:hover {
        box-shadow: var(--shadow-xl), var(--glow-success);
    }

    .stat-card.warning {
        background: var(--warning-gradient);
    }

    .stat-card.warning:hover {
        box-shadow: var(--shadow-xl), var(--glow-warning);
    }

    .stat-card.info {
        background: var(--info-gradient);
    }

    .period-btn {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        cursor: pointer;
        user-select: none;
        z-index: 1;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 20px;
    }

    .period-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        border-radius: inherit;
        opacity: 0;
        transition: all 0.4s ease;
        z-index: -1;
    }

    .period-btn::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
        border-radius: 22px;
        z-index: -2;
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .period-btn:hover::before {
        opacity: 1;
        transform: scale(1.02);
    }

    .period-btn:hover::after {
        opacity: 0.7;
    }

    .period-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        transform: translateY(-4px) scale(1.05);
        box-shadow: var(--shadow-xl), var(--glow-primary);
        border-color: transparent !important;
        animation: pulseGlow 2s infinite;
    }

    @keyframes pulseGlow {
        0%, 100% { box-shadow: var(--shadow-xl), var(--glow-primary); }
        50% { box-shadow: var(--shadow-xl), 0 0 30px rgba(102, 126, 234, 0.5); }
    }

    .period-btn.active * {
        color: white !important;
    }

    .period-btn:hover:not(.active) {
        transform: translateY(-3px) scale(1.02);
        box-shadow: var(--shadow-large);
        border-color: rgba(102, 126, 234, 0.5) !important;
    }

    .period-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        pointer-events: none;
    }

    .custom-date-range {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        transform: translateY(-20px);
    }

    .custom-date-range.show {
        max-height: 300px;
        opacity: 1;
        transform: translateY(0);
        animation: slideInDown 0.6s ease;
    }

    @keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .floating-elements {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
    }

    .floating-elements::before,
    .floating-elements::after {
        content: '';
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        animation: float 6s ease-in-out infinite;
    }

    .floating-elements::before {
        width: 60px;
        height: 60px;
        top: 20%;
        right: 10%;
        animation-delay: -2s;
    }

    .floating-elements::after {
        width: 40px;
        height: 40px;
        bottom: 20%;
        left: 15%;
        animation-delay: -4s;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
    }

    .generate-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        background-size: 200% 200%;
        animation: gradientFlow 3s ease infinite;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        cursor: pointer;
        user-select: none;
        z-index: 1;
        border: none;
        border-radius: 20px;
        box-shadow: var(--shadow-large);
    }

    @keyframes gradientFlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .generate-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
        border-radius: inherit;
        opacity: 0;
        transition: all 0.4s ease;
        z-index: -1;
    }

    .generate-btn::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe);
        background-size: 300% 300%;
        animation: borderGlow 4s ease infinite;
        border-radius: 22px;
        z-index: -2;
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    @keyframes borderGlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .generate-btn:hover::before {
        opacity: 1;
        transform: scale(1.05);
    }

    .generate-btn:hover::after {
        opacity: 1;
    }

    .generate-btn:hover:not(:disabled) {
        transform: translateY(-5px) scale(1.02);
        box-shadow: var(--shadow-xl), 0 0 40px rgba(102, 126, 234, 0.4);
        animation: generatePulse 1.5s ease infinite;
    }

    @keyframes generatePulse {
        0%, 100% { box-shadow: var(--shadow-xl), 0 0 40px rgba(102, 126, 234, 0.4); }
        50% { box-shadow: var(--shadow-xl), 0 0 60px rgba(102, 126, 234, 0.6); }
    }

    .generate-btn:active {
        transform: translateY(-2px) scale(0.98);
    }

    .generate-btn:disabled {
        opacity: 0.6 !important;
        cursor: not-allowed !important;
        transform: none !important;
        pointer-events: none;
        animation: none !important;
    }

    .pulse-animation {
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    .slide-in-up {
        animation: slideInUp 0.6s ease-out;
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in {
        animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Mobile responsiveness improvements */
    @media (max-width: 768px) {
        .stat-card {
            padding: 1rem;
        }

        .stat-card .text-4xl {
            font-size: 2rem;
        }

        .period-btn {
            padding: 0.75rem;
        }

        .period-btn span {
            font-size: 0.75rem;
        }

        .generate-btn {
            padding: 0.75rem 2rem;
            font-size: 1rem;
        }
    }

    /* Loading animation improvements */
    .loading-dots::after {
        content: '';
        animation: dots 1.5s steps(5, end) infinite;
    }

    @keyframes dots {
        0%, 20% { content: ''; }
        40% { content: '.'; }
        60% { content: '..'; }
        80%, 100% { content: '...'; }
    }

    /* Accessibility improvements */
    .period-btn:focus,
    .generate-btn:focus,
    input:focus {
        outline: 2px solid #667eea;
        outline-offset: 2px;
    }

    /* Ensure buttons are always clickable */
    .period-btn,
    .generate-btn {
        pointer-events: auto !important;
        cursor: pointer !important;
        position: relative;
        z-index: 10;
    }

    .period-btn *,
    .generate-btn * {
        pointer-events: none;
    }

    /* Print styles */
    @media print {
        .no-print {
            display: none !important;
        }
    }

    .progress-bar {
        height: 4px;
        background: rgba(255,255,255,0.3);
        border-radius: 2px;
        overflow: hidden;
        margin-top: 8px;
    }

    .progress-fill {
        height: 100%;
        background: rgba(255,255,255,0.8);
        border-radius: 2px;
        transition: width 0.3s ease;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        padding: 16px 24px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        transform: translateX(400px);
        transition: transform 0.3s ease;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.success {
        background: var(--success-gradient);
    }

    .notification.error {
        background: var(--danger-gradient);
    }

    .notification.info {
        background: var(--info-gradient);
    }
</style>
{% endblock %}

{% block content %}
{% csrf_token %}
<div class="p-4 md:p-6 max-w-7xl mx-auto fade-in relative">
    <!-- Floating Background Elements -->
    <div class="floating-elements"></div>

    <!-- Page Header -->
    <div class="mb-8 slide-in-up relative z-10">
        <div class="glass-card rounded-3xl p-8 mb-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                <div class="flex items-center space-x-6">
                    <div class="relative">
                        <div class="bg-gradient-to-r from-blue-500 via-purple-600 to-pink-500 p-4 rounded-2xl shadow-xl">
                            <i class="fas fa-chart-line text-white text-2xl"></i>
                        </div>
                        <div class="absolute -top-1 -right-1 w-6 h-6 bg-green-400 rounded-full border-2 border-white animate-pulse"></div>
                    </div>
                    <div>
                        <h1 class="text-4xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">
                            Performance Reports
                        </h1>
                        <p class="text-gray-600 mt-2 text-lg">Generate comprehensive performance and earnings reports with detailed analytics</p>
                    </div>
                </div>
                <div class="glass-effect rounded-2xl p-6 border border-white/30">
                    <div class="text-sm text-white flex items-center mb-2">
                        <i class="far fa-calendar-alt mr-2 text-blue-200"></i>
                        <span class="font-medium">{{ now|date:"l, F j, Y" }}</span>
                    </div>
                    <div class="text-xs text-blue-100">
                        Report Generation Dashboard
                    </div>
                    <div class="mt-3 flex items-center text-xs text-green-200">
                        <div class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                        System Online
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tailor Information Card -->
    <div class="relative mb-8 slide-in-up">
        <div class="glass-card rounded-3xl p-8 relative overflow-hidden">
            <!-- Animated Background Pattern -->
            <div class="absolute inset-0 opacity-5">
                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-blue-500 via-purple-600 to-pink-500 animate-pulse"></div>
            </div>

            <!-- Floating Decorative Elements -->
            <div class="absolute top-4 right-4 w-20 h-20 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full opacity-10 animate-bounce" style="animation-delay: 0s;"></div>
            <div class="absolute bottom-4 left-4 w-16 h-16 bg-gradient-to-r from-pink-400 to-red-500 rounded-full opacity-10 animate-bounce" style="animation-delay: 1s;"></div>
            <div class="absolute top-1/2 left-1/2 w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-full opacity-10 animate-bounce" style="animation-delay: 2s;"></div>

            <div class="relative z-10">
                <div class="flex flex-col md:flex-row md:items-center gap-8">
                    <div class="relative">
                        <div class="bg-gradient-to-r from-blue-500 via-purple-600 to-pink-500 rounded-3xl p-8 shadow-xl">
                            <i class="fas fa-user-tie text-white text-5xl"></i>
                        </div>
                        <div class="absolute -top-2 -right-2 w-8 h-8 bg-green-400 rounded-full border-4 border-white shadow-lg animate-pulse"></div>
                    </div>
                    <div class="flex-1">
                        <h2 class="text-4xl font-bold mb-3 bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">
                            {{ tailor.user.get_full_name }}
                        </h2>
                        <div class="flex flex-wrap items-center gap-4 mb-4">
                            <span class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-full text-sm font-medium shadow-lg">
                                <i class="fas fa-star mr-2"></i>Professional Tailor
                            </span>
                            <span class="bg-gradient-to-r from-purple-500 to-pink-600 text-white px-4 py-2 rounded-full text-sm font-medium shadow-lg">
                                <i class="fas fa-id-badge mr-2"></i>ID: T{{ tailor.id|stringformat:"04d" }}
                            </span>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-gray-600">
                            <div class="flex items-center bg-blue-50 p-3 rounded-xl">
                                <i class="fas fa-envelope text-blue-500 mr-3"></i>
                                <span class="text-sm font-medium">{{ tailor.user.email }}</span>
                            </div>
                            {% if tailor.phone_number %}
                            <div class="flex items-center bg-green-50 p-3 rounded-xl">
                                <i class="fas fa-phone text-green-500 mr-3"></i>
                                <span class="text-sm font-medium">{{ tailor.phone_number }}</span>
                            </div>
                            {% endif %}
                            <div class="flex items-center bg-purple-50 p-3 rounded-xl">
                                <i class="fas fa-calendar-plus text-purple-500 mr-3"></i>
                                <span class="text-sm font-medium">Joined {{ tailor.user.date_joined|date:"M Y" }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Overview -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 slide-in-up">
        <!-- Total Tasks -->
        <div class="stat-card info rounded-2xl p-6 text-white relative">
            <div class="flex items-center justify-between relative z-10">
                <div class="flex-1">
                    <p class="text-blue-100 text-sm font-medium mb-1">Total Tasks</p>
                    <p class="text-4xl font-bold mb-2">{{ total_tasks }}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm">
                    <i class="fas fa-tasks text-2xl"></i>
                </div>
            </div>
            <div class="absolute bottom-2 right-2 text-xs text-blue-200 opacity-75">
                All assigned tasks
            </div>
        </div>

        <!-- Completed Tasks -->
        <div class="stat-card success rounded-2xl p-6 text-white relative">
            <div class="flex items-center justify-between relative z-10">
                <div class="flex-1">
                    <p class="text-green-100 text-sm font-medium mb-1">Completed Tasks</p>
                    <p class="text-4xl font-bold mb-2">{{ completed_tasks }}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% if total_tasks > 0 %}{{ completion_rate|floatformat:0 }}{% else %}0{% endif %}%"></div>
                    </div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm">
                    <i class="fas fa-check-circle text-2xl"></i>
                </div>
            </div>
            <div class="absolute bottom-2 right-2 text-xs text-green-200 opacity-75">
                {% if total_tasks > 0 %}{{ completion_rate|floatformat:1 }}% completion{% else %}No tasks yet{% endif %}
            </div>
        </div>

        <!-- In Progress -->
        <div class="stat-card warning rounded-2xl p-6 text-white relative">
            <div class="flex items-center justify-between relative z-10">
                <div class="flex-1">
                    <p class="text-yellow-100 text-sm font-medium mb-1">In Progress</p>
                    <p class="text-4xl font-bold mb-2">{{ in_progress_tasks }}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% if total_tasks > 0 %}{% widthratio in_progress_tasks total_tasks 100 %}{% else %}0{% endif %}%"></div>
                    </div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm">
                    <i class="fas fa-clock text-2xl"></i>
                </div>
            </div>
            <div class="absolute bottom-2 right-2 text-xs text-yellow-200 opacity-75">
                Currently active
            </div>
        </div>

        <!-- Total Earnings -->
        <div class="stat-card rounded-2xl p-6 text-white relative">
            <div class="flex items-center justify-between relative z-10">
                <div class="flex-1">
                    <p class="text-purple-100 text-sm font-medium mb-1">Total Earnings</p>
                    <p class="text-4xl font-bold mb-2">₱{{ total_commissions|floatformat:0 }}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% if total_commissions > 0 %}{% widthratio paid_commissions total_commissions 100 %}{% else %}0{% endif %}%"></div>
                    </div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm">
                    <i class="fas fa-money-bill-wave text-2xl"></i>
                </div>
            </div>
            <div class="absolute bottom-2 right-2 text-xs text-purple-200 opacity-75">
                ₱{{ paid_commissions|floatformat:0 }} paid
            </div>
        </div>
    </div>

    <!-- Report Generation Section -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 slide-in-up">
        <!-- Report Options -->
        <div class="lg:col-span-2">
            <div class="glass-card rounded-3xl p-8 relative overflow-hidden">
                <!-- Animated Background -->
                <div class="absolute inset-0 bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 opacity-30"></div>

                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent flex items-center">
                            <div class="bg-gradient-to-r from-blue-500 via-purple-600 to-pink-500 p-4 rounded-2xl mr-4 shadow-xl relative">
                                <i class="fas fa-cog text-white text-xl"></i>
                                <div class="absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-600 to-pink-500 rounded-2xl animate-pulse opacity-50"></div>
                            </div>
                            Report Configuration
                        </h3>
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-full shadow-lg">
                            <span class="text-sm font-medium flex items-center">
                                <i class="fas fa-step-forward mr-2"></i>
                                Step 1 of 2
                            </span>
                        </div>
                    </div>

                    <!-- Time Period Selection -->
                    <div class="mb-8">
                        <label class="block text-2xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent mb-6 flex items-center">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-xl mr-3 shadow-lg">
                                <i class="fas fa-calendar-alt text-white"></i>
                            </div>
                            Select Time Period
                        </label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <button type="button" class="period-btn px-6 py-4 rounded-xl border-2 border-gray-200 text-center transition-all duration-300 active" data-period="last_month" tabindex="0" onclick="selectPeriod('last_month', this)">
                            <i class="fas fa-calendar-alt text-blue-500 mb-2 block text-lg"></i>
                            <span class="text-sm font-semibold block">Last Month</span>
                            <span class="text-xs text-gray-500 block mt-1">Previous 30 days</span>
                        </button>
                        <button type="button" class="period-btn px-6 py-4 rounded-xl border-2 border-gray-200 text-center transition-all duration-300" data-period="last_quarter" tabindex="0" onclick="selectPeriod('last_quarter', this)">
                            <i class="fas fa-calendar-week text-blue-500 mb-2 block text-lg"></i>
                            <span class="text-sm font-semibold block">Last Quarter</span>
                            <span class="text-xs text-gray-500 block mt-1">Previous 3 months</span>
                        </button>
                        <button type="button" class="period-btn px-6 py-4 rounded-xl border-2 border-gray-200 text-center transition-all duration-300" data-period="ytd" tabindex="0" onclick="selectPeriod('ytd', this)">
                            <i class="fas fa-calendar-year text-blue-500 mb-2 block text-lg"></i>
                            <span class="text-sm font-semibold block">Year to Date</span>
                            <span class="text-xs text-gray-500 block mt-1">Jan 1 to today</span>
                        </button>
                        <button type="button" class="period-btn px-6 py-4 rounded-xl border-2 border-gray-200 text-center transition-all duration-300" data-period="all_time" tabindex="0" onclick="selectPeriod('all_time', this)">
                            <i class="fas fa-infinity text-blue-500 mb-2 block text-lg"></i>
                            <span class="text-sm font-semibold block">All Time</span>
                            <span class="text-xs text-gray-500 block mt-1">Complete history</span>
                        </button>
                        <button type="button" class="period-btn px-6 py-4 rounded-xl border-2 border-gray-200 text-center transition-all duration-300" data-period="last_week" tabindex="0" onclick="selectPeriod('last_week', this)">
                            <i class="fas fa-calendar-day text-blue-500 mb-2 block text-lg"></i>
                            <span class="text-sm font-semibold block">Last Week</span>
                            <span class="text-xs text-gray-500 block mt-1">Previous 7 days</span>
                        </button>
                        <button type="button" class="period-btn px-6 py-4 rounded-xl border-2 border-gray-200 text-center transition-all duration-300" data-period="custom" tabindex="0" onclick="selectPeriod('custom', this)">
                            <i class="fas fa-calendar-plus text-blue-500 mb-2 block text-lg"></i>
                            <span class="text-sm font-semibold block">Custom Range</span>
                            <span class="text-xs text-gray-500 block mt-1">Choose dates</span>
                        </button>
                    </div>
                </div>

                    <!-- Custom Date Range -->
                    <div id="customDateRange" class="custom-date-range mb-8">
                        <div class="glass-effect rounded-2xl p-8 border border-white/30 relative overflow-hidden">
                            <!-- Animated Background -->
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-pink-500/10 animate-pulse"></div>

                            <div class="relative z-10">
                                <h4 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent mb-6 flex items-center">
                                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-xl mr-3 shadow-lg">
                                        <i class="fas fa-calendar-range text-white"></i>
                                    </div>
                                    Custom Date Range
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div class="space-y-3">
                                        <label class="block text-sm font-bold text-gray-700">From Date</label>
                                        <div class="relative">
                                            <input type="date" id="dateFrom" class="w-full px-6 py-4 border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-300 bg-white/90 backdrop-blur-sm shadow-lg hover:shadow-xl">
                                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5 rounded-2xl pointer-events-none"></div>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <label class="block text-sm font-bold text-gray-700">To Date</label>
                                        <div class="relative">
                                            <input type="date" id="dateTo" class="w-full px-6 py-4 border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-300 bg-white/90 backdrop-blur-sm shadow-lg hover:shadow-xl">
                                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5 rounded-2xl pointer-events-none"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200">
                                    <p class="text-sm text-blue-700 flex items-center font-medium">
                                        <i class="fas fa-info-circle mr-3 text-blue-500"></i>
                                        Select a date range to generate a custom report for the specified period.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="text-center">
                        <div class="glass-effect rounded-2xl p-8 mb-8 relative overflow-hidden">
                            <!-- Animated Background -->
                            <div class="absolute inset-0 bg-gradient-to-r from-green-500/10 via-blue-500/10 to-purple-500/10 animate-pulse"></div>

                            <div class="relative z-10">
                                <div class="flex items-center justify-center mb-6">
                                    <div class="bg-gradient-to-r from-green-400 to-emerald-500 p-4 rounded-full mr-4 shadow-xl animate-bounce">
                                        <i class="fas fa-check text-white text-xl"></i>
                                    </div>
                                    <span class="text-2xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">Ready to generate your report</span>
                                </div>
                                <p class="text-gray-600 mb-6 text-lg">Your report will include task performance, earnings breakdown, and detailed analytics.</p>
                            </div>
                        </div>

                        <button type="button" id="generateReportBtn" class="generate-btn text-white px-16 py-6 font-bold text-xl shadow-xl hover:shadow-2xl transition-all duration-400 relative overflow-hidden mb-6" tabindex="0" onclick="generateReportDirect()">
                            <span class="relative z-10 flex items-center justify-center">
                                <i class="fas fa-file-pdf mr-4 text-2xl"></i>
                                Generate Performance Report
                            </span>
                        </button>

                        <div class="flex items-center justify-center text-gray-500 text-sm">
                            <i class="fas fa-shield-alt mr-2 text-green-500"></i>
                            <span class="font-medium">Your data is processed securely and confidentially</span>
                        </div>

                    <!-- Fallback for JavaScript disabled -->
                    <noscript>
                        <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <p class="text-sm text-yellow-800">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                JavaScript is disabled. You can still generate reports using this direct link:
                            </p>
                            <a href="/generate-report/?period=last_month" class="inline-block mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Generate Last Month Report
                            </a>
                        </div>
                    </noscript>
                </div>
            </div>
        </div>

        <!-- Report Preview/Info -->
        <div class="space-y-6">
            <!-- What's Included -->
            <div class="bg-white rounded-2xl shadow-large p-6 border border-gray-100 slide-in-up">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-3 rounded-xl mr-3 shadow-lg">
                        <i class="fas fa-list-check text-white"></i>
                    </div>
                    What's Included
                </h3>
                <div class="space-y-4">
                    <div class="flex items-start p-3 bg-green-50 rounded-xl border border-green-200">
                        <div class="bg-green-500 rounded-full p-1 mr-3 mt-0.5">
                            <i class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 text-sm">Task Performance Metrics</p>
                            <p class="text-xs text-gray-600 mt-1">Detailed analysis of completed and pending tasks</p>
                        </div>
                    </div>
                    <div class="flex items-start p-3 bg-blue-50 rounded-xl border border-blue-200">
                        <div class="bg-blue-500 rounded-full p-1 mr-3 mt-0.5">
                            <i class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 text-sm">Commission Earnings Breakdown</p>
                            <p class="text-xs text-gray-600 mt-1">Comprehensive financial summary with payment status</p>
                        </div>
                    </div>
                    <div class="flex items-start p-3 bg-purple-50 rounded-xl border border-purple-200">
                        <div class="bg-purple-500 rounded-full p-1 mr-3 mt-0.5">
                            <i class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 text-sm">Completion Rate Analysis</p>
                            <p class="text-xs text-gray-600 mt-1">Performance trends and efficiency metrics</p>
                        </div>
                    </div>
                    <div class="flex items-start p-3 bg-orange-50 rounded-xl border border-orange-200">
                        <div class="bg-orange-500 rounded-full p-1 mr-3 mt-0.5">
                            <i class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 text-sm">Monthly Performance Trends</p>
                            <p class="text-xs text-gray-600 mt-1">Historical data and growth patterns</p>
                        </div>
                    </div>
                    <div class="flex items-start p-3 bg-indigo-50 rounded-xl border border-indigo-200">
                        <div class="bg-indigo-500 rounded-full p-1 mr-3 mt-0.5">
                            <i class="fas fa-check text-white text-xs"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 text-sm">Professional Formatting</p>
                            <p class="text-xs text-gray-600 mt-1">Clean, branded PDF ready for sharing</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="bg-white rounded-2xl shadow-large p-6 border border-gray-100 slide-in-up">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <div class="bg-gradient-to-r from-purple-500 to-pink-600 p-3 rounded-xl mr-3 shadow-lg">
                        <i class="fas fa-chart-pie text-white"></i>
                    </div>
                    Quick Overview
                </h3>
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-semibold text-gray-700 flex items-center">
                                <i class="fas fa-percentage text-green-500 mr-2"></i>
                                Completion Rate
                            </span>
                            <span class="font-bold text-green-600 text-lg">
                                {% if total_tasks > 0 %}
                                    {{ completion_rate|floatformat:1 }}%
                                {% else %}
                                    0%
                                {% endif %}
                            </span>
                        </div>
                        <div class="text-xs text-gray-600">
                            {% if total_tasks > 0 %}
                                {{ completed_tasks }} of {{ total_tasks }} tasks completed
                            {% else %}
                                No tasks assigned yet
                            {% endif %}
                        </div>
                        <div class="w-full bg-green-200 rounded-full h-2 mt-2">
                            <div class="bg-green-500 h-2 rounded-full transition-all duration-500" style="width: {% if total_tasks > 0 %}{{ completion_rate|floatformat:1 }}{% else %}0{% endif %}%"></div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-semibold text-gray-700 flex items-center">
                                <i class="fas fa-money-check-alt text-blue-500 mr-2"></i>
                                Paid Commissions
                            </span>
                            <span class="font-bold text-blue-600 text-lg">₱{{ paid_commissions|floatformat:0 }}</span>
                        </div>
                        <div class="text-xs text-gray-600">Successfully processed payments</div>
                    </div>

                    <div class="bg-gradient-to-r from-orange-50 to-yellow-50 p-4 rounded-xl border border-orange-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-semibold text-gray-700 flex items-center">
                                <i class="fas fa-clock text-orange-500 mr-2"></i>
                                Pending Commissions
                            </span>
                            <span class="font-bold text-orange-600 text-lg">₱{{ pending_commissions|floatformat:0 }}</span>
                        </div>
                        <div class="text-xs text-gray-600">Awaiting approval and payment</div>
                    </div>

                    {% if total_commissions > 0 %}
                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-4 rounded-xl border border-purple-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-semibold text-gray-700 flex items-center">
                                <i class="fas fa-chart-line text-purple-500 mr-2"></i>
                                Total Potential
                            </span>
                            <span class="font-bold text-purple-600 text-lg">₱{{ total_commissions|floatformat:0 }}</span>
                        </div>
                        <div class="text-xs text-gray-600">Combined earnings potential</div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
    <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl border border-gray-200">
        <div class="relative mb-6">
            <div class="animate-spin rounded-full h-20 w-20 border-4 border-blue-200 border-t-blue-600 mx-auto"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i class="fas fa-file-pdf text-blue-600 text-xl"></i>
            </div>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-3">Generating Your Report</h3>
        <p class="text-gray-600 text-sm mb-4">Please wait while we compile your performance data and create your professional report...</p>
        <div class="bg-blue-50 rounded-lg p-3">
            <div class="flex items-center justify-center text-blue-600 text-sm">
                <i class="fas fa-shield-alt mr-2"></i>
                <span>Processing securely</span>
            </div>
        </div>
        <div class="mt-4">
            <div class="bg-gray-200 rounded-full h-2">
                <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-xs text-gray-500 mt-2">This may take a few moments...</p>
        </div>
    </div>
</div>

<!-- Notification Container -->
<div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

<script>
// Global variables
let selectedPeriod = 'last_month';
let isGenerating = false;

// Simple, direct functions that work immediately
function selectPeriod(period, buttonElement) {
    console.log('selectPeriod called:', period);

    if (isGenerating) {
        console.log('Generation in progress, ignoring click');
        return;
    }

    // Remove active class from all buttons
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    // Add active class to clicked button
    buttonElement.classList.add('active');
    selectedPeriod = period;

    console.log('Selected period:', selectedPeriod);

    // Show/hide custom date range
    const customDateRange = document.getElementById('customDateRange');
    if (customDateRange) {
        if (period === 'custom') {
            customDateRange.classList.add('show');
            setTimeout(() => {
                const dateFromInput = document.getElementById('dateFrom');
                if (dateFromInput) dateFromInput.focus();
            }, 200);
        } else {
            customDateRange.classList.remove('show');
        }
    }

    // Update generate button text
    updateGenerateButtonText();

    // Visual feedback
    buttonElement.style.transform = 'scale(0.95)';
    setTimeout(() => {
        buttonElement.style.transform = '';
    }, 150);

    alert('Selected: ' + period.replace('_', ' '));
}

function generateReportDirect() {
    console.log('generateReportDirect called');

    if (isGenerating) {
        alert('Report generation already in progress');
        return;
    }

    alert('Generating report for: ' + selectedPeriod);

    // Start generation
    isGenerating = true;

    // Build URL
    let url = '/generate-report/';
    const params = new URLSearchParams();

    if (selectedPeriod === 'custom') {
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;

        if (!dateFrom || !dateTo) {
            alert('Please select both start and end dates for custom range');
            isGenerating = false;
            return;
        }

        params.append('date_from', dateFrom);
        params.append('date_to', dateTo);
    } else {
        params.append('period', selectedPeriod);
    }

    if (params.toString()) {
        url += '?' + params.toString();
    }

    console.log('Report URL:', url);

    // Try to download
    try {
        window.open(url, '_blank');
        setTimeout(() => {
            isGenerating = false;
            alert('Report download started! Check your downloads folder.');
        }, 2000);
    } catch (error) {
        console.error('Error:', error);
        isGenerating = false;
        alert('Error generating report: ' + error.message);
    }
}

function updateGenerateButtonText() {
    const btn = document.getElementById('generateReportBtn');
    if (!btn) return;

    const periodText = {
        'last_month': 'Last Month',
        'last_quarter': 'Last Quarter',
        'ytd': 'Year to Date',
        'all_time': 'All Time',
        'last_week': 'Last Week',
        'custom': 'Custom Range'
    };

    const period = periodText[selectedPeriod] || 'Performance';
    btn.innerHTML = `<span class="relative z-10 flex items-center justify-center"><i class="fas fa-file-pdf mr-3 text-xl"></i>Generate ${period} Report</span>`;
}

// Main initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM Content Loaded - Initializing report page');

    // Wait for DOM to be fully ready
    setTimeout(function() {
        console.log('Starting initialization...');

        // Initialize all components
        initializeDates();
        initializePeriodButtons();
        initializeGenerateButton();
        initializeValidation();

        console.log('Initialization complete');
    }, 100);
});

// Function definitions
function initializeDates() {
    console.log('Initializing dates...');
    const today = new Date();
    const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());

    const dateToInput = document.getElementById('dateTo');
    const dateFromInput = document.getElementById('dateFrom');

    if (dateToInput && dateFromInput) {
        dateToInput.value = today.toISOString().split('T')[0];
        dateFromInput.value = lastMonth.toISOString().split('T')[0];

        // Set max date to today for both inputs
        dateToInput.max = today.toISOString().split('T')[0];
        dateFromInput.max = today.toISOString().split('T')[0];

        console.log('Dates initialized successfully');
    } else {
        console.error('Date inputs not found');
    }
}

function initializePeriodButtons() {
    console.log('Initializing period buttons...');
    const buttons = document.querySelectorAll('.period-btn');
    console.log('Found period buttons:', buttons.length);

    if (buttons.length === 0) {
        console.error('No period buttons found!');
        return;
    }

    buttons.forEach((btn, index) => {
        console.log(`Setting up button ${index}:`, btn.dataset.period);

        // Clear any existing event listeners
        btn.onclick = null;

        // Add click event listener
        btn.addEventListener('click', function(e) {
            console.log('Period button clicked:', this.dataset.period);
            handlePeriodClick.call(this, e);
        });

        // Add keyboard support
        btn.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                console.log('Period button activated via keyboard:', this.dataset.period);
                handlePeriodClick.call(this, e);
            }
        });

        // Ensure button is focusable and clickable
        btn.style.cursor = 'pointer';
        btn.style.pointerEvents = 'auto';
        btn.tabIndex = 0;
    });

    console.log('Period buttons initialized successfully');
}

function handlePeriodClick(e) {
    console.log('handlePeriodClick called for:', this.dataset.period);

    if (isGenerating) {
        console.log('Generation in progress, ignoring click');
        return;
    }

    // Visual feedback - add a temporary flash effect
    this.style.transform = 'scale(0.95)';
    setTimeout(() => {
        this.style.transform = '';
    }, 150);

    // Remove active class from all buttons
    document.querySelectorAll('.period-btn').forEach(b => {
        b.classList.remove('active');
    });

    // Add active class to clicked button
    this.classList.add('active');
    selectedPeriod = this.dataset.period;

    console.log('Selected period updated to:', selectedPeriod);

    // Show/hide custom date range
    const customDateRange = document.getElementById('customDateRange');
    if (customDateRange) {
        if (selectedPeriod === 'custom') {
            customDateRange.classList.add('show');
            // Focus on first date input after animation
            setTimeout(() => {
                const dateFromInput = document.getElementById('dateFrom');
                if (dateFromInput) dateFromInput.focus();
            }, 200);
        } else {
            customDateRange.classList.remove('show');
        }
    }

    // Update button text for better UX
    updateGenerateButtonText();

    // Show success notification
    showNotification(`Selected ${this.dataset.period.replace('_', ' ')} period`, 'info');
}

function initializeGenerateButton() {
    console.log('Initializing generate button...');
    const generateBtn = document.getElementById('generateReportBtn');
    console.log('Generate button found:', !!generateBtn);

    if (!generateBtn) {
        console.error('Generate button not found!');
        return;
    }

    // Clear any existing event listeners
    generateBtn.onclick = null;

    // Add click event listener
    generateBtn.addEventListener('click', function(e) {
        console.log('Generate button clicked');
        handleGenerateClick.call(this, e);
    });

    // Add keyboard support
    generateBtn.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            console.log('Generate button activated via keyboard');
            handleGenerateClick.call(this, e);
        }
    });

    // Ensure button is focusable and clickable
    generateBtn.style.cursor = 'pointer';
    generateBtn.style.pointerEvents = 'auto';
    generateBtn.tabIndex = 0;

    console.log('Generate button initialized successfully');
}

function handleGenerateClick(e) {
    console.log('handleGenerateClick called');

    if (isGenerating) {
        console.log('Already generating, ignoring click');
        return;
    }

    // Visual feedback - add a temporary flash effect
    this.style.transform = 'scale(0.95)';
    setTimeout(() => {
        this.style.transform = '';
    }, 150);

    generateReport();
}

    function initializeValidation() {
        // Real-time validation for custom date inputs
        document.getElementById('dateFrom').addEventListener('change', validateDateRange);
        document.getElementById('dateTo').addEventListener('change', validateDateRange);
    }

    function validateDateRange() {
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;

        if (dateFrom && dateTo) {
            const fromDate = new Date(dateFrom);
            const toDate = new Date(dateTo);

            if (fromDate > toDate) {
                showNotification('Start date cannot be later than end date', 'error');
                document.getElementById('dateFrom').classList.add('border-red-500');
                document.getElementById('dateTo').classList.add('border-red-500');
                return false;
            } else {
                document.getElementById('dateFrom').classList.remove('border-red-500');
                document.getElementById('dateTo').classList.remove('border-red-500');
                return true;
            }
        }
        return true;
    }

    function updateGenerateButtonText() {
        const btn = document.getElementById('generateReportBtn');
        const periodText = {
            'last_month': 'Last Month',
            'last_quarter': 'Last Quarter',
            'ytd': 'Year to Date',
            'all_time': 'All Time',
            'last_week': 'Last Week',
            'custom': 'Custom Range'
        };

        const period = periodText[selectedPeriod] || 'Performance';
        btn.innerHTML = `<span class="relative z-10 flex items-center justify-center"><i class="fas fa-file-pdf mr-3 text-xl"></i>Generate ${period} Report</span>`;
    }

    function generateReport() {
        console.log('generateReport called');

        if (isGenerating) {
            console.log('Already generating, returning');
            return;
        }

        const period = selectedPeriod;
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;

        console.log('Report parameters:', { period, dateFrom, dateTo });

        // Validate custom date range
        if (period === 'custom') {
            if (!dateFrom || !dateTo) {
                console.log('Missing dates for custom range');
                showNotification('Please select both start and end dates for custom range', 'error');
                return;
            }

            if (!validateDateRange()) {
                console.log('Date range validation failed');
                return;
            }
        }

        console.log('Starting report generation...');

        // Start generation process
        startReportGeneration();

        // Build URL with proper CSRF handling
        const url = buildReportUrl(period, dateFrom, dateTo);
        console.log('Report URL:', url);

        // Attempt to download the report
        downloadReport(url);
    }

    function startReportGeneration() {
        isGenerating = true;

        // Show loading modal with progress animation
        const modal = document.getElementById('loadingModal');
        modal.classList.remove('hidden');

        // Animate progress bar
        animateProgressBar();

        // Disable generate button with loading state
        const generateBtn = document.getElementById('generateReportBtn');
        generateBtn.disabled = true;
        generateBtn.classList.add('opacity-60', 'cursor-not-allowed');
        generateBtn.innerHTML = '<span class="relative z-10 flex items-center justify-center"><i class="fas fa-spinner fa-spin mr-3"></i>Generating Report...</span>';

        // Disable period buttons
        document.querySelectorAll('.period-btn').forEach(btn => {
            btn.disabled = true;
            btn.classList.add('opacity-60', 'cursor-not-allowed');
        });
    }

    function animateProgressBar() {
        const progressBar = document.getElementById('progressBar');
        let progress = 0;

        const interval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 90) progress = 90;

            progressBar.style.width = progress + '%';

            if (progress >= 90) {
                clearInterval(interval);
            }
        }, 200);

        // Store interval for cleanup
        window.progressInterval = interval;
    }

    function buildReportUrl(period, dateFrom, dateTo) {
        let url = '/generate-report/';
        const params = new URLSearchParams();

        if (period === 'custom') {
            params.append('date_from', dateFrom);
            params.append('date_to', dateTo);
        } else {
            params.append('period', period);
        }

        if (params.toString()) {
            url += '?' + params.toString();
        }

        return url;
    }

    function downloadReport(url) {
        try {
            // Create a temporary link to download the PDF
            const link = document.createElement('a');
            link.href = url;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Finish generation process after a delay to allow download to start
            setTimeout(() => {
                finishReportGeneration(true);
            }, 2000);

        } catch (error) {
            console.error('Download error:', error);
            finishReportGeneration(false);
            showNotification('An error occurred while generating the report.', 'error');
        }
    }

    function finishReportGeneration(success = true) {
        isGenerating = false;

        // Complete progress bar
        const progressBar = document.getElementById('progressBar');
        progressBar.style.width = '100%';

        // Clear progress interval
        if (window.progressInterval) {
            clearInterval(window.progressInterval);
        }

        setTimeout(() => {
            // Hide loading modal
            document.getElementById('loadingModal').classList.add('hidden');

            // Reset progress bar
            progressBar.style.width = '0%';

            // Re-enable generate button
            const generateBtn = document.getElementById('generateReportBtn');
            generateBtn.disabled = false;
            generateBtn.classList.remove('opacity-60', 'cursor-not-allowed');
            updateGenerateButtonText();

            // Re-enable period buttons
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('opacity-60', 'cursor-not-allowed');
            });

            // Show success notification
            if (success) {
                showNotification('Report generated successfully! Check your downloads.', 'success');
            }
        }, 500);
    }

    function showNotification(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');

        notification.className = `notification ${type} flex items-center p-4 rounded-xl shadow-lg max-w-sm`;
        notification.innerHTML = `
            <i class="fas fa-${getNotificationIcon(type)} mr-3"></i>
            <span class="flex-1">${message}</span>
            <button onclick="this.parentElement.remove()" class="ml-3 text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        `;

        container.appendChild(notification);

        // Show notification
        setTimeout(() => notification.classList.add('show'), 100);

        // Auto remove after 5 seconds
        setTimeout(() => {
            if (notification.parentElement) {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }
        }, 5000);
    }

    function getNotificationIcon(type) {
        const icons = {
            'success': 'check-circle',
            'error': 'exclamation-circle',
            'info': 'info-circle',
            'warning': 'exclamation-triangle'
        };
        return icons[type] || 'info-circle';
    }

    // Handle page visibility change to reset state if needed
    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'visible' && isGenerating) {
            // Reset state if user comes back to page during generation
            setTimeout(() => {
                if (isGenerating) {
                    finishReportGeneration(false);
                    showNotification('Report generation was interrupted. Please try again.', 'warning');
                }
            }, 3000);
        }
    });

// Global debug functions
window.debugReportPage = {
    selectedPeriod: () => selectedPeriod,
    isGenerating: () => isGenerating,
    generateReport: () => generateReport(),
    testPeriodClick: (period) => {
        const btn = document.querySelector(`[data-period="${period}"]`);
        if (btn) {
            console.log('Testing period click for:', period);
            btn.click();
        } else {
            console.error('Button not found for period:', period);
        }
    },
    testGenerateClick: () => {
        const btn = document.getElementById('generateReportBtn');
        if (btn) {
            console.log('Testing generate button click');
            btn.click();
        } else {
            console.error('Generate button not found');
        }
    },
    checkElements: () => {
        console.log('Period buttons:', document.querySelectorAll('.period-btn').length);
        console.log('Generate button:', !!document.getElementById('generateReportBtn'));
        console.log('Custom date range:', !!document.getElementById('customDateRange'));
    }
};

console.log('Report page JavaScript loaded successfully');
console.log('Available debug functions:', Object.keys(window.debugReportPage));
});
</script>

{% endblock %}
