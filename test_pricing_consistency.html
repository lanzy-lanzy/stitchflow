<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Consistency Test - StitchFlow</title>
    <script src="static/js/pricing.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { color: green; }
        .fail { color: red; }
        .test-result { margin: 5px 0; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>StitchFlow Pricing Consistency Test</h1>
    
    <div class="test-section">
        <h2>1. Garment Price Verification</h2>
        <p>Testing that all garment types have correct fixed prices:</p>
        <table id="priceTable">
            <thead>
                <tr>
                    <th>Garment Type</th>
                    <th>Expected Price</th>
                    <th>Actual Price</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="priceTableBody">
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>2. Down Payment Calculation Test</h2>
        <p>Testing 50% down payment calculations:</p>
        <div id="downPaymentTests"></div>
    </div>

    <div class="test-section">
        <h2>3. Currency Formatting Test</h2>
        <p>Testing consistent ₱X.XX formatting:</p>
        <div id="currencyTests"></div>
    </div>

    <div class="test-section">
        <h2>4. Order Total Calculation Test</h2>
        <p>Testing quantity-based total calculations:</p>
        <table id="totalTable">
            <thead>
                <tr>
                    <th>Garment Type</th>
                    <th>Quantity</th>
                    <th>Expected Total</th>
                    <th>Actual Total</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="totalTableBody">
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>5. Pricing Validation Test</h2>
        <p>Testing pricing validation logic:</p>
        <div id="validationTests"></div>
    </div>

    <div class="test-section">
        <h2>Test Summary</h2>
        <div id="testSummary"></div>
    </div>

    <script>
        let totalTests = 0;
        let passedTests = 0;

        function runTest(testName, condition, details = '') {
            totalTests++;
            const result = condition;
            if (result) passedTests++;
            
            return {
                name: testName,
                passed: result,
                details: details,
                html: `<div class="test-result ${result ? 'pass' : 'fail'}">
                    ${result ? '✓' : '✗'} ${testName} ${details ? '- ' + details : ''}
                </div>`
            };
        }

        function runAllTests() {
            console.log('Running StitchFlow Pricing Consistency Tests...');

            // Test 1: Garment Price Verification
            const expectedPrices = {
                'BLOUSE': 550.00,
                'PANTS': 650.00,
                'SKIRT': 500.00,
                'DRESS': 800.00,
                'JACKET': 750.00,
                'OTHERS': 600.00
            };

            const priceTableBody = document.getElementById('priceTableBody');
            Object.entries(expectedPrices).forEach(([garmentType, expectedPrice]) => {
                const actualPrice = PricingManager.getGarmentPrice(garmentType);
                const isCorrect = actualPrice === expectedPrice;
                
                const test = runTest(`${garmentType} Price`, isCorrect, 
                    `Expected: ₱${expectedPrice}, Got: ₱${actualPrice}`);
                
                priceTableBody.innerHTML += `
                    <tr>
                        <td>${garmentType}</td>
                        <td>₱${expectedPrice.toFixed(2)}</td>
                        <td>₱${actualPrice.toFixed(2)}</td>
                        <td class="${isCorrect ? 'pass' : 'fail'}">${isCorrect ? 'PASS' : 'FAIL'}</td>
                    </tr>
                `;
            });

            // Test 2: Down Payment Calculations
            const downPaymentTests = document.getElementById('downPaymentTests');
            const testAmounts = [100, 550, 650, 800, 1200];
            testAmounts.forEach(amount => {
                const expectedDownPayment = amount * 0.5;
                const actualDownPayment = PricingManager.calculateDownPayment(amount);
                const test = runTest(`Down Payment for ₱${amount}`, 
                    actualDownPayment === expectedDownPayment,
                    `Expected: ₱${expectedDownPayment}, Got: ₱${actualDownPayment}`);
                downPaymentTests.innerHTML += test.html;
            });

            // Test 3: Currency Formatting
            const currencyTests = document.getElementById('currencyTests');
            const testValues = [0, 100, 550.50, 1234.567];
            testValues.forEach(value => {
                const formatted = PricingManager.formatCurrency(value);
                const expected = `₱${value.toFixed(2)}`;
                const test = runTest(`Format ${value}`, 
                    formatted === expected,
                    `Expected: ${expected}, Got: ${formatted}`);
                currencyTests.innerHTML += test.html;
            });

            // Test 4: Order Total Calculations
            const totalTableBody = document.getElementById('totalTableBody');
            const testCases = [
                ['BLOUSE', 1, 550.00],
                ['BLOUSE', 2, 1100.00],
                ['PANTS', 1, 650.00],
                ['DRESS', 3, 2400.00],
                ['JACKET', 2, 1500.00]
            ];

            testCases.forEach(([garmentType, quantity, expectedTotal]) => {
                const actualTotal = PricingManager.calculateOrderTotal(garmentType, quantity);
                const isCorrect = actualTotal === expectedTotal;
                
                const test = runTest(`${garmentType} x${quantity} Total`, isCorrect,
                    `Expected: ₱${expectedTotal}, Got: ₱${actualTotal}`);
                
                totalTableBody.innerHTML += `
                    <tr>
                        <td>${garmentType}</td>
                        <td>${quantity}</td>
                        <td>₱${expectedTotal.toFixed(2)}</td>
                        <td>₱${actualTotal.toFixed(2)}</td>
                        <td class="${isCorrect ? 'pass' : 'fail'}">${isCorrect ? 'PASS' : 'FAIL'}</td>
                    </tr>
                `;
            });

            // Test 5: Pricing Validation
            const validationTests = document.getElementById('validationTests');
            const validationCases = [
                ['BLOUSE', 1, 550.00, true],
                ['BLOUSE', 1, 600.00, false],
                ['PANTS', 2, 1300.00, true],
                ['DRESS', 1, 750.00, false]
            ];

            validationCases.forEach(([garmentType, quantity, totalAmount, shouldBeValid]) => {
                const validation = PricingManager.validatePricing(garmentType, quantity, totalAmount);
                const test = runTest(`Validation: ${garmentType} x${quantity} = ₱${totalAmount}`, 
                    validation.isValid === shouldBeValid,
                    validation.message);
                validationTests.innerHTML += test.html;
            });

            // Test Summary
            const testSummary = document.getElementById('testSummary');
            const passRate = ((passedTests / totalTests) * 100).toFixed(1);
            testSummary.innerHTML = `
                <h3>Results: ${passedTests}/${totalTests} tests passed (${passRate}%)</h3>
                <div class="${passedTests === totalTests ? 'pass' : 'fail'}">
                    ${passedTests === totalTests ? 
                        '✓ All tests passed! Pricing is consistent across the application.' : 
                        '✗ Some tests failed. Please review the pricing implementation.'}
                </div>
            `;

            console.log(`Test Results: ${passedTests}/${totalTests} passed (${passRate}%)`);
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>
